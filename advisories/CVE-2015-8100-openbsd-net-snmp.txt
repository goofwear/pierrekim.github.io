-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

## Advisory Information

Title: OpenBSD package 'net-snmp' information disclosure
Advisory URL: https://pierrekim.github.io/advisories/CVE-2015-8100-openbsd-net-snmp.txt
Blog URL: https://pierrekim.github.io/blog/2015-11-12-CVE-2015-8100-OpenBSD-package-net-snmp-information-disclosure.html
Date published: 2015-11-12
Vendors contacted: Stuart Henderson, OpenBSD Package maintainer
Release mode: Released
CVE: CVE-2015-8100



## Product Description

Net-SNMP is a suite of applications used to implement SNMP v1, SNMP v2c and
SNMP v3 using both IPv4 and IPv6.

This software is available in OpenBSD as a port (/usr/ports/net/net-snmp).



## Vulnerabilities Summary

By default, when OpenBSD package and ports are used, the snmpd configuration file
has weak permissions which allows a local user to retrieve sensitive information.



## Details

By default the permissions of the snmpd configuration file in OpenBSD
are 0644 instead of 0600:

  # cd /usr/ports/net/net-snmp
  # make install clean
  [...]
  # ls -latr /etc/snmp/snmpd.conf
  -rw-r--r--  1 root  wheel  6993 Nov  4 09:16 /etc/snmp/snmpd.conf
  #

The same problem occurs when the provided package is installed with
`pkg_add http://ftp.spline.de/pub/OpenBSD/5.8/packages/i386/net-snmp-5.7.3p0.tgz`:

  # ls -latr /etc/snmp/snmpd.conf
  -rw-r--r--  1 root  wheel  6993 Nov  4 08:37 /etc/snmp/snmpd.conf
  #

The snmpd configuration file is readable by a local user and contains the credentials
for read-only and read-write access (for SNMPv1, SNMPv2 and SNMPv3 protocols) and
gives a local user unnecessary/dangerous access:


  [...]

  rocommunity public  default    -V systemonly
  #rocommunity secret  10.0.0.0/16
  rouser   authOnlyUser
  #rwuser   authPrivUser   priv

  [...]

This problem is OpenBSD-specific as the /var/db/pkg/net-snmp-5.7.3p0/+CONTENTS file confirms:
  @ts 1438958635
  @sample /etc/snmp/snmpd.conf

Futhermore, by default, `/usr/local/sbin/snmpd` runs as root.



## Vendor Response

This problem has been fixed in the -STABLE and -CURRENT packages.



## Report Timeline

 * Nov 04, 2015: Vulnerability found by Pierre Kim.
 * Nov 05, 2015: Stuart Henderson is notified of the vulnerability.
 * Nov 06, 2015: Stuart Henderson confirms the vulnerability and fixes the package permissions for the sample configuration file in -current and -stable.
 * Nov 06, 2015: Stuart Henderson re-activates an option (can be configured with rc.conf.local) to run net-snmp as a separate uid to improve security.
 * Nov 10, 2015: OSS-Security is contacted to get a CVE
 * Nov 10, 2015: cve-assign@mitre.org assigns CVE-2015-8100
 * Nov 12, 2015: A public advisory is sent to security mailing lists.



## Credit

This vulnerability was found by Pierre Kim (@PierreKimSec).



## References

https://pierrekim.github.io/advisories/CVE-2015-8100-openbsd-net-snmp.txt
http://openports.se/net/net-snmp



## Disclaimer

This advisory is licensed under a Creative Commons Attribution Non-Commercial
Share-Alike 3.0 License: http://creativecommons.org/licenses/by-nc-sa/3.0/

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCgAGBQJWRIzqAAoJEMQ+Dtp9ky28PjMP/RIGloeO3+X4XqGvTUuIMy4T
YdGu/ZvPO6AjKrH2XOKCcQ3NpS5HMi0y4e3KK/BK8pH2sRb4HDX0RU8AOGSCNH3R
/kNdnPiQmzE9GwDZVYojnAh+sS+seH2aGxGdxrg9DlxgttrhdjCsVPOHTRi+4CBG
BbSSnKTV2eCQpybaDb3ndc6fqKEvtPuhOrMmprjkQlnVySVGzWWjgBDKfvCYKd/5
OyVUGoA8y4dKQMFRBRKkyS0bG0rzgkRA05oQgYXysem76sYyevww+D4U7giGUKH6
EoGQFkJt3To8LI2g3L4+CLfs6woL7Nmm7QjQP1iyyuw6s+TOvxYewkNAmLabqlpH
B+CZ3TU+B0UeANvQ4ZWeoHZwcifROufrlSJ2ibXAnUzWRszetp8jcSrqNDgIbMv2
Q7wV6MHFMHKsn2XryZ/OFBImq7kXhIAkjd5SLTUJm9eti8FO5O82vaZVe5ZqzURW
Z6p5E2WkIIWVF2JkG2xV9mvTdXhnC+g2j0zoNP9WntB6HJDeBpwT8nOI6RfbwT3k
OwsmiQ3ePlbY3YIHVct4J7WOBHxcTkfI0fy2MFP/HuJ/2+o1ofF21bKNXarF/FcK
1JeJzKDv4ZqmFza/ytGL1mSjAcYUEfHZzPAOpl+ff/Qz7TGWryWF3H4yZhh72k3E
NgtArcJCcG/GQInISVew
=6wZK
-----END PGP SIGNATURE-----
